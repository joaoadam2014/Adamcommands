<html lang="pt-br">
    <head>
        <style>
            #Conteudo{
                right:0%;
                position: absolute;
                border:1px solid #333;
                height:100%;
                width:50%;
            }
            #h{
                bottom:10%;
                position: absolute;
                height: 250px;
                border:1px solid #333;
                width:49%;
                font-size: xx-small;
            }
            b{
                font-size: medium;
            }
            #code_box{
                width:50%;
                height:400px;
                text-align: left;
                vertical-align: auto;
            }
            #Arquivo{
                position: absolute;
                text-align: left;
                vertical-align: auto;
                left:0%;
            }
            .elementoOutro { color: blue; font-weight: bold; }
            .sucesso { color: green; }
            .erro { color: red; }
            .padrao{ color: orange;   background-color: #242424; }

        </style>
    </head>
    <body style="background-color: #242424; ">
        <p id="Conteudo" style="background-color: white;"></p>
        <p style="color: white;"> se não sabe usar está engine e não sabe programar em adamCommand abra a <a href="Documentacao.html">documentação</a></p>
        <p id="h" class="elementoOutro, sucesso, erro, padrao"><b>Historico:</b><br></p>
        <button onclick="execute(0, 0)">Acontecer codigo</button><button onclick="exportar()">Exportar codigo</button><button onclick="inportar()">carregar codigo inportado</button><br><br>
        <textarea type="text" id="code_box" class="elementoOutro, sucesso, erro, padrao"></textarea>
        <input type="file" id="Arquivo" accept="codigo,.AdamCommand" class="elementoOutro, sucesso, erro, padrao">
        <script type="text/javascript">
        let inputs=document.querySelectorAll("textarea")
        let q=0
        let selecionado=0
        let input= inputs[selecionado]
        let falar=document.getElementById("Conteudo")
        let historico=document.getElementById("h")
        let vars={
            "key":0,
        }
        let funcs={}
        async function execute(m,b){
            let comandos=input.value.split(")")
            for (let i=0; i<comandos.length; i++){
                if (b==0){comandos=input.value.split(")")}else{comandos=b}
                if (m==0){var palavra=comandos[i]}else{var palavra=comandos[m]}
                palavra=palavra.trim()
                if (!palavra){ continue}
                if (palavra.split("(")[0]=="box"){
                    let height=palavra.split("(")[1].split(";")[1]
                    let width=palavra.split("(")[1].split(";")[2]
                    let posX=palavra.split("(")[1].split(";")[4]
                    let posY=palavra.split("(")[1].split(";")[5]
                    if (isNaN(height)){height=conseguirvar(height)}
                    if (isNaN(width)){width=conseguirvar(width)}
                    if (isNaN(posX)){posX=conseguirvar(posX)}
                    if (isNaN(posY)){posY=conseguirvar(posY)}
                   falar.innerHTML=falar.innerHTML+"<div class='"+palavra.split("(")[1].split(";")[3]+"'style='background:"+palavra.split("(")[1].split(";")[0]+";height:"+height+"px;width:"+width+"px;border-radius:0px;position:absolute;left:"+posX+";bottom:"+posY+"'></div>"
                   historico.innerHTML=historico.innerHTML+"<br><span class='sucesso'>Caixa gerada com sucesso:"+palavra.split("(")[1].split(";")[3]+", caixa de cor "+palavra.split("(")[1].split(";")[0]+", altura de:"+palavra.split("(")[1].split(";")[1]+", com sua largura de:"+palavra.split("(")[1].split(";")[2]+"</span>"
                   continue
                }
                if (palavra.split("(")[0]=="stop"){
                    falar.innerHTML=""
                    historico.innerHTML=historico.innerHTML+"<br><span class='elementoOutro'> codigo parado </span>"
                    break
                }
                if (palavra.split("(")[0]=="clear"){
                    falar.innerHTML=""
                    historico.innerHTML=historico.innerHTML+"<br>><span class='elementoOutro'> codigo limpo </span>"
                    continue
                }
                if (palavra.split("(")[0]=="text"){
                    falar.innerHTML=falar.innerHTML+"<h"+palavra.split("(")[1].split(";")[1]+">"+palavra.split("(")[1].split(";")[0]+"</h"+palavra.split("(")[1].split(";")[1]+">"
                    historico.innerHTML=historico.innerHTML+"<br><span class='sucesso'> texto gerado, conteudo do texto:'"+palavra.split("(")[1].split(";")[0]+"',Tamanho do texto:"+palavra.split("(")[1].split(";")[1]+"</span>"
                    continue
                }
                if (palavra.split("(")[0]=="insert"){
                    falar.innerHTML=falar.innerHTML+palavra.split("(")[1].split(";")[0]
                    historico.innerHTML=historico.innerHTML+"<br><span class='sucesso'> Elemento html inserido com sucesso</span>"
                    continue
                }
                if (palavra.split("(")[0]=="circle"){
                    let height=palavra.split("(")[1].split(";")[1]
                    let width=palavra.split("(")[1].split(";")[2]
                    let posX=palavra.split("(")[1].split(";")[4]
                    let posY=palavra.split("(")[1].split(";")[5]
                    if (isNaN(height)){height=conseguirvar(height)}
                    if (isNaN(width)){width=conseguirvar(width)}
                    if (isNaN(posX)){posX=conseguirvar(posX)}
                    if (isNaN(posY)){posY=conseguirvar(posY)}
                    let circunferencia=palavra.split("(")[1].split(";")[2]/2
                   falar.innerHTML=falar.innerHTML+"<div class='"+palavra.split("(")[1].split(";")[3]+"'style='background:"+palavra.split("(")[1].split(";")[0]+";height:"+height+"px;width:"+width+"px;border-radius:"+circunferencia+"px;position:absolute;left:"+posX+";bottom:"+posY+"'></div>"
                   historico.innerHTML=historico.innerHTML+"<br><span class='sucesso'>Circulo gerada com sucesso:"+palavra.split("(")[1].split(";")[3]+", circulo de cor "+palavra.split("(")[1].split(";")[0]+", altura de:"+palavra.split("(")[1].split(";")[1]+", com sua largura de:"+palavra.split("(")[1].split(";")[2]+"</span>"
                   continue
                }
                if (palavra.split("(")[0]=="triangle"){
                    let height=palavra.split("(")[1].split(";")[1]
                    let width=palavra.split("(")[1].split(";")[2]
                    let posX=palavra.split("(")[1].split(";")[4]
                    let posY=palavra.split("(")[1].split(";")[5]
                    let nome=palavra.split("(")[1].split(";")[3]
                    let cor=palavra.split("(")[1].split(";")[0]
                    let d = `M ${0.5 * width},${0.2 * height} L ${0.8 * width},${0.8 * height} L ${0.2 * width},${0.8 * height} Z`;
                    if (isNaN(height)){height=conseguirvar(height)}
                    if (isNaN(width)){width=conseguirvar(width)}
                    if (isNaN(posX)){posX=conseguirvar(posX)}
                    if (isNaN(posY)){posY=conseguirvar(posY)}
                    let circunferencia=palavra.split("(")[1].split(";")[2]/2
                   falar.innerHTML=falar.innerHTML+"<svg><path d="+d+" fill='"+cor+"' ></path></svg>"
                   historico.innerHTML=historico.innerHTML+"<br><span class='sucesso'>Triangulo gerado com sucesso:"+palavra.split("(")[1].split(";")[3]+", circulo de cor "+palavra.split("(")[1].split(";")[0]+", altura de:"+palavra.split("(")[1].split(";")[1]+", com sua largura de:"+palavra.split("(")[1].split(";")[2]+"</span>"
                   continue
                }
                if (palavra.split("(")[0]=="img"){
                    let height=palavra.split("(")[1].split(";")[1]
                    let width=palavra.split("(")[1].split(";")[2]
                    let posX=palavra.split("(")[1].split(";")[4]
                    let posY=palavra.split("(")[1].split(";")[5]
                    if (isNaN(height)){height=conseguirvar(height)}
                    if (isNaN(width)){width=conseguirvar(width)}
                    if (isNaN(posX)){posX=conseguirvar(posX)}
                    if (isNaN(posY)){posY=conseguirvar(posY)}
                   falar.innerHTML=falar.innerHTML+"<img class='"+palavra.split("(")[1].split(";")[3]+"'style='"+";height:"+height+"px;width:"+width+"px;border-radius:0px;position:absolute;left:"+posX+";bottom:"+posY+"' src='"+palavra.split("(")[1].split(";")[0]+"'></img>"
                   historico.innerHTML=historico.innerHTML+"<br><span class='sucesso'>Caixa de imagem gerada com sucesso:"+palavra.split("(")[1].split(";")[3]+", imagem de textura "+palavra.split("(")[1].split(";")[0]+", altura de:"+palavra.split("(")[1].split(";")[1]+", com sua largura de:"+palavra.split("(")[1].split(";")[2]+"</span>"
                   continue
                }
                if (palavra.split("(")[0]=="wait"){
                    let Time=palavra.split("(")[1].split(";")[0]
                    let params=palavra.split("(")[1].split(";")
                    if (isNaN(Time))
                    {Time=conseguirvar(Time)}
                    await new Promise(resolve =>setTimeout(resolve,Time))
                   historico.innerHTML=historico.innerHTML+"<br><span class='sucesso'>Temporizador de "+Time+" Milesimos gerado com sucesso</span>"
                    continue
                }
                if (palavra.split("{")[0]=="ever"){
                    let params=palavra.split("{")[1].split(";")
                    let Vezes=parseInt(palavra.split("{")[1].split(";")[0])
                    var Atraso=parseInt(palavra.split("{")[1].split(";")[1])
                    if (isNaN(Atraso))
                    {Atraso=conseguirvar(Atraso)}
                    var trecho=input.value.split("endever")[0].split("}")[1]
                    for (let r=0; r<trecho.length ;r++){
                        await new Promise(resolve =>setTimeout(resolve,Atraso))
                        let cmdR=trecho.split("(")
                        execute(r,0)
                        continue;             
                    }
                     continue;
                }
                if (palavra.startsWith("if(")){


                    let Condicao=palavra.split("if(")[1].split("/")[0]


                    let restante=input.value.split(palavra+")")[1]

                    let bloco=palavra.split("if(")[1].split("/")[1]

                    let verif=function (){
                        if (Condicao.includes("==")){let numeros=Condicao.split("==")
                            let valor1=Number(numeros[0]); let valor2=Number(numeros[1]); 
                            if(isNaN(valor1)) {valor1=conseguirvar(valor1)}
                            if(isNaN(valor2)) {valor2=conseguirvar(valor2)}
                            if (valor1==valor2){return(true)}else{return(false)}
                        }
                        if (Condicao.includes("IM")){let numeros=Condicao.split("IM")
                            let valor1=Number(numeros[0]); let valor2=Number(numeros[1]); 
                            if(isNaN(valor1)) {valor1=conseguirvar(valor1)}
                            if(isNaN(valor2)) {valor2=conseguirvar(valor2)}
                            if (valor1<=valor2){return(true)}else{return(false)}
                        }
                        if (Condicao.includes("MI")){let numeros=Condicao.split("MI")
                            let valor1=Number(numeros[0]); let valor2=Number(numeros[1]); 
                            if(isNaN(valor1)) {valor1=conseguirvar(valor1)}
                            if(isNaN(valor2)) {valor2=conseguirvar(valor2)}
                            if (valor1>=valor2){return(true)}else{return(false)}
                        }
                        if (Condicao.includes("NN")){let numeros=Condicao.split("NN")
                            let valor1=Number(numeros[0]); let valor2=Number(numeros[1]); 
                            if(isNaN(valor1)) {valor1=conseguirvar(valor1)}
                            if(isNaN(valor2)) {valor2=conseguirvar(valor2)}
                            if (valor1!=valor2){return(true)}else{return(false)}
                        } 
                        if (Condicao.includes(">")){let numeros=Condicao.split(">")
                            let valor1=Number(numeros[0]); let valor2=Number(numeros[1]); 
                            if(isNaN(valor1)) {valor1=conseguirvar(valor1)}
                            if(isNaN(valor2)) {valor2=conseguirvar(valor2)}
                            if (valor1>valor2){return(true)}else{return(false)}
                        }
                        if (Condicao.includes("<")){let numeros=Condicao.split("<")
                            let valor1=Number(numeros[0]); let valor2=Number(numeros[1]); 
                            if(isNaN(valor1)) {valor1=conseguirvar(valor1)}
                            if(isNaN(valor2)) {valor2=conseguirvar(valor2)}
                            if (valor1<valor2){return(true)}else{return(false)}
                        }
                        return false
                    };
                      if (verif()){
                        await execute(0, bloco.split(")"))
                        alert(Condicao)     
                      }else{
                        if (bloco.includes("else(")){
                            let SeNao=bloco.indexOf("else(")
                            let final=bloco.indexOf(")")
                            let SeNaoBlock=bloco.slice(SeNao, final)
                            await execute(0, SeNaoBlock.split(")"))
                        }
                      }
                    continue;
                }
               if (palavra.startsWith("press(")){
                    let Condicao=palavra.split("press(")[1].split("/")[0]
                    Condicao=Condicao.trim()
                    let restante=input.value.split(palavra+")")[1]

                    let bloco=palavra.split("press(")[1].split("/")[1]
                    bloco=bloco.slice(0, bloco.lastIndexOf(")")).trim()
                    let letras=conseguirvar("key")
                    if (letras==Condicao){
                        await execute(0,bloco.split(")"))
                        
                    }
                }
                if (palavra.startsWith("value(")){
                    let parametros=palavra.split("(")[1].split(")")[0]
                    let nome=parametros.split(";")[0]
                    let valor=parametros.split(";")[1]
                    let operador=null;
                    if (isNaN(valor)){valor=conseguirvar(valor)}
                    valor=String(valor).trim()
                    if (valor.includes("+")) operador = "+";
                    else if (valor.includes("-")) operador = "-";
                    else if (valor.includes("*")) operador = "*";
                    else if (valor.includes("/")) operador = "/";
                    if (operador){
                        let [esq, dir]=valor.split(operador)
                        if (isNaN(esq)) esq=conseguirvar(esq);
                        if (isNaN(dir)) dir=conseguirvar(dir);
                        if (operador=="+") valor=esq+dir;
                        if (operador=="-") valor=esq-dir;
                        if (operador=="*") valor=esq*dir;
                        if (operador=="/") valor=esq/dir;
                    }
                    vars[nome]=valor
                    historico.innerHTML=historico.innerHTML+"<br><span class='sucesso'>Variavel criada com sucesso: "+nome+" agora aplique como parâmetro para seus comandos!</span>"
                    continue;
                }
                if (palavra.startsWith("func(")){
                    let conteudo=palavra.slice(5,-1).trim()
                    let [nome, valor]=conteudo.split("/")
                    nome=nome.trim(); valor=valor.trim()
                    funcs[nome]=valor
                    historico.innerHTML=historico.innerHTML+"<br><span class='sucesso'>Funcao criada com sucesso: "+nome+"Chame agora está funcao!</span>"+valor
                    continue;
                }
                if (palavra.startsWith("call(")){
                    let nome=palavra.slice(5,palavra.length).trim()
                    if (funcs[nome]){
                        await execute(0,funcs[nome].split(")"))
                        historico.innerHTML=historico.innerHTML+"<br><span class='sucesso'>Nova funcao chamada com sucesso "+nome+"Chame agora está funcao!</span>"
                    }else{
                        historico.innerHTML=historico.innerHTML+"<br><span class='erro'>A funcao:"+nome+"nao existe, se possivel olhe o codigo ou consulte o historico</span>"
                    }
                  
                    continue;
                }
           }
           function conseguirvar(id){
                return vars[id]
           }
           document.addEventListener("keydown",(e)=>{
                vars["key"]=e.key
                window.setTimeout(()=>{vars["key"]=0},500)
           })
        }
        function exportar(){
            let codigo=input.value
            let blob = new Blob([codigo],{ type:"text/plain"})
            let url =URL.createObjectURL(blob)

            let a= document.createElement("a")
            a.href=url
            a.download="codigo.AdamCommand"
            a.click()
            URL.revokeObjectURL(url)
        }
        function inportar(){
            let leitor=new FileReader
            let inputfile=document.getElementById("Arquivo")
            if (!inputfile.files.length){alert("falha na importação erro 0")}
            let conteudo=inputfile.files[0]
            leitor.onload=(e)=>{
                let conteudo2=e.target.result
               input.value=conteudo2
                console.log(conteudo2)
            }
            leitor.onerror=function(){
                alert("falha na importação, erro 1")
            }
            leitor.readAsText(conteudo)
        }
        window.setInterval(()=>{
            let palavras=input.value.split(")")
            let palavra=palavras[palavras.length]
            let pesquisas={
                "circle":"gera um circulo",
                "box":"gera um cubo"
            }
            if (pesquisas[palavra]){
                alert(pesquisas[palavra])
            }
        },1000)
        </script>
        <iframe src="PaginasSecundarias/PaginaAifromAdam.html" width="200px" height="120px" style="position: fixed; right:0; top:0;"></iframe>
</html>